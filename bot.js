const Discord = require('discord.js');
const client = new Discord.Client();

client.on('ready', () => {
  console.log(`Logged in as ${client.user.tag}!`);
  client.user.setGame("#ENFELATEH..","https://www.twitch.tv/idk");
});
var prefix = "#";
client.on('message', function(message) {
    if (message.author.bot) return;
    if (message.author.id === client.user.id) return;
    if (message.author.equals(client.user)) return;
    if (!message.content.startsWith(prefix)) return;

    var args = message.content.substring(prefix.length).split(' ');

    switch (args[0].toLocaleLowerCase()) {
          case "clear" :
if(!message.channel.guild) return
                                if(message.member.hasPermissions(0x2000)){ if (!args[1]) {
        message.channel.fetchMessages()
          .then(messages => {
            message.channel.bulkDelete(messages);
       var     messagesDeleted = messages.array().length;
             var embed = new Discord.RichEmbed()
             .setDescription('Message Deleted ' + messagesDeleted+ ':checkered_flag: ')
             .setColor('RANDOM')
            message.channel.sendEmbed(embed);
          })
                            } else {
                            let messagecount = parseInt(args[1]);
        message.channel.fetchMessages({limit: messagecount}).then(messages => message.channel.bulkDelete(messages));
                  let clear = new Discord.RichEmbed()

                                                   .setColor('RANDOM')
             .setDescription('Messages Deleted ' + args[1])
             message.channel.sendEmbed(clear)
                                                                                        message.delete(60000);
               }
                    } else {
                        var manage = new Discord.RichEmbed()
                        .setDescription('You Do Not Have Permission `MANAGE_MESSAGES :(')
                        .setColor("RANDOM")
                        message.channel.sendEmbed(manage)
                        return;
                    }
break;

}
});





client.on('message' , message => {
  if(message.author.bot) return;
  if(message.content.startsWith("!ping")) {
 message.channel.send('pong').then((msg) => {
var PinG = `${Date.now() - msg.createdTimestamp}`
var ApL = `${Math.round(client.ping)}`
      msg.edit(`\`\`\`javascript\nTime taken: ${PinG} ms.\nDiscord API: ${ApL} ms.\`\`\``);
 })
  }  
 });


client.on('message', message => {
 if (message.content.startsWith("#id")) {
var args = message.content.split(" ").slice(1);
let user = message.mentions.users.first();
var men = message.mentions.users.first();
var heg;
if(men) {
  heg = men
} else {
  heg = message.author
}
var mentionned = message.mentions.members.first();
var h;
if(mentionned) {
  h = mentionned
} else {
  h = message.member
}
     moment.locale('ar-TN');
var id = new  Discord.RichEmbed()
.setColor("RANDOM")
.addField(': انضمامك لسيرفر قبل', `${moment(h.joinedAt).format('YYYY/M/D HH:mm:ss')} \n \`${moment(h.joinedAt).fromNow()}\``, true)
.addField(': دخولك لديسكورد قبل', `${moment(heg.createdTimestamp).format('YYYY/M/D HH:mm:ss')} **\n** \`${moment(heg.createdTimestamp).fromNow()}\`` ,true)
.setThumbnail(message.author.avatarURL)
.setFooter('#En');
message.channel.send(id)
}       });

client.on('message', message => {
  if (message.content === '#avatar') {
    message.channel.sendMessage(message.author.avatarURL);
  }
});


client.on('guildMemberAdd', member => {

    const channel = member.guild.channels.find('name', '・text');
  
    const millis = new Date().getTime() - member.user.createdAt.getTime();
    const now = new Date();
    const createdAt = millis / 1000 / 60 / 60 / 24;




  
    const embed = new Discord.RichEmbed()
    
    .setColor("black")
    .setDescription(`**تاريخ دخولك للدسكورد منذ ${createdAt.toFixed(0)} يوم**`)
    .setAuthor(member.user.tag, member.user.avatarURL);
    channel.sendEmbed(embed);

  
});


client.on('message', message => {
if(!message.channel.guild) return;
if(message.content.startsWith('اسحب')) {
 if (message.member.hasPermission("MOVE_MEMBERS")) {
 if (message.mentions.users.size === 0) {
}
if (message.member.voiceChannel != null) {
 if (message.mentions.members.first().voiceChannel != null) {
 var authorchannel = message.member.voiceChannelID;
 var usermentioned = message.mentions.members.first().id;
var embed = new Discord.RichEmbed()
 .setTitle("Succes!")
 .setColor("#000000")
 .setDescription(`:white_check_mark: <@${usermentioned}> Moved. `)
var embed = new Discord.RichEmbed()
.setTitle(`You are Moved in ${message.guild.name}`)
 .setColor("RANDOM")
.setDescription(`**<@${message.author.id}> Moved You To His Channel!\nServer --> ${message.guild.name}**`)
 message.guild.members.get(usermentioned).setVoiceChannel(authorchannel).then(m => message.channel.send(embed))
message.guild.members.get(usermentioned).send(embed)
} else {
message.channel.send("``لا تستطيع سحب "+ message.mentions.members.first() +" `يجب ان يكون هذه العضو في روم صوتي`")
}
} else {
 message.channel.send("**``يجب ان تكون في روم صوتي لكي تقوم بسحب العضو أليك``**")
}
} else {
message.react("❌")
 }}});


client.login(process.env.BOT_TOKEN); //
